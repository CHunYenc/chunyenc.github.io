<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Python on CHUN-YEN's BLOG</title><link>https://chunyenc.github.io/tags/python/</link><description>Recent content in Python on CHUN-YEN's BLOG</description><generator>Hugo -- gohugo.io</generator><language>zh-tw</language><lastBuildDate>Mon, 11 Jul 2022 17:31:45 +0800</lastBuildDate><atom:link href="https://chunyenc.github.io/tags/python/index.xml" rel="self" type="application/rss+xml"/><item><title>Django 紀錄 01 - 將 Django App 程式碼轉成 Cython 來保護程式碼</title><link>https://chunyenc.github.io/p/2022-django-01-protect-code/</link><pubDate>Mon, 11 Jul 2022 17:31:45 +0800</pubDate><guid>https://chunyenc.github.io/p/2022-django-01-protect-code/</guid><description>&lt;img src="https://chunyenc.github.io/django.png" alt="Featured image of post Django 紀錄 01 - 將 Django App 程式碼轉成 Cython 來保護程式碼" />&lt;h1 id="前言">前言&lt;/h1>
&lt;p>主要就是將原始程式碼轉成暗碼，雖然能夠不讓自己的程式碼直接裸奔。&lt;/p>
&lt;p>但是若碰到有心人士也是一樣可以透過逆向工程把你的程式碼還原。&lt;/p>
&lt;p>提到明碼轉成暗碼，優先選擇 Cython 來執行，速度甚至可能變快(?)，實際上當然還沒測試，只是看到非常多人透過 Cython 讓自己 Python 程式碼變快 XD&lt;/p>
&lt;p>真是期待，但今天並不是來測試效能，而是優先將 Django-app 轉換成 so 檔執行 !!&lt;/p>
&lt;h1 id="操作">操作&lt;/h1>
&lt;p>可以參考 Reference 第一篇文章的程式碼來執行，但是我這邊主要也是整理一下我自己實作的部分提供參考。&lt;/p>
&lt;h2 id="操作環境">操作環境&lt;/h2>
&lt;p>使用 WSL2，要注意如果使用 Windows 進行 Cython，&lt;/p>
&lt;p>在執行上面有跑出問題，所以我是放棄了。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">root@DESKTOP-xxx:/mnt/c/Users/xxx# lsb_release -a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">No LSB modules are available.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Distributor ID: Ubuntu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Description: Ubuntu 18.04.6 LTS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Release: 18.04
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codename: bionic
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="資料夾架構">資料夾架構&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@DESKTOP-xxx:/core$ tree -L &lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── apps
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── app1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── __init__.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── admin.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── apps.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── functions
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── migrations
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── models.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── tests.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── urls.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── views.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── build_clear.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── build_py_to_so.py &lt;span class="c1"># 本文主角&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── core
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── __init__.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── asgi.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── settings.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── urls.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── variables.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── wsgi.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── logs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── debug.log
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── manage.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── requirements.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── run_venv.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── templates
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── venv
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>其中最重要的就是 &lt;code>build_py_to_so.py&lt;/code> 這支檔案，待會會將程式碼貼在本文。&lt;/p>
&lt;p>另外為了防止疑惑，以下說明其他資料夾的內容&lt;/p>
&lt;ul>
&lt;li>關於 Django
&lt;ul>
&lt;li>core - 為 django project 主要資料夾&lt;/li>
&lt;li>apps - 為 django app 生成的位置，如果建立在主目錄會非常亂&lt;/li>
&lt;li>logs - 儲存 log 檔的資料夾&lt;/li>
&lt;li>templates - 儲存 html 檔的資料夾&lt;/li>
&lt;li>manage.py - django 預設&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>關於 Python
&lt;ul>
&lt;li>venv - 虛擬環境&lt;/li>
&lt;li>requirements.txt - pip freeze, 為需要用的的套件&lt;/li>
&lt;li>build_clear.py - 自動清理 &lt;code>.py&lt;/code>、&lt;code>.c&lt;/code> 檔案，建議參考 Reference 第一篇文章
&lt;ul>
&lt;li>程式碼連結：&lt;a class="link" href="https://gist.github.com/CHunYenc/adcdd234aab33d621fdfa127e41ee16a" target="_blank" rel="noopener"
>https://gist.github.com/CHunYenc/adcdd234aab33d621fdfa127e41ee16a&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>其他
&lt;ul>
&lt;li>run_venv.sh&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="如何將-app-從-py-轉為-cython">如何將 APP 從 py 轉為 cython&lt;/h2>
&lt;h3 id="build_py_to_sopy">build_py_to_so.py&lt;/h3>
&lt;h3 id="導入套件">導入套件&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python3" data-lang="python3">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">distutils.core&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">setup&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">distutils.extension&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Extension&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">Cython.Build&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">cythonize&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">Cython.Distutils&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">build_ext&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">Cython.Compiler&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上面是使用到的套件，非常簡單，大部分都是 import Cython 套件。&lt;/p>
&lt;h3 id="取得-app-路徑">取得 app 路徑&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python3" data-lang="python3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># app 的資料夾名稱&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">app_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;app1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># app 使用 function 資料夾架構&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">functions_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;functions&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 取得 app1 資料夾路徑&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">app_folder&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">getcwd&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="s1">&amp;#39;apps&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">app_name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 取得 app1/functions/*.py &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">function_file&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">app_folder&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;functions&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="s1">&amp;#39;*.py&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 取得 app1/*.py&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">app_file&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">app_folder&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;*.py&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>上面是取得資料夾的一些路徑，如果你有非常多的 app 要把程式碼轉為 cython，&lt;/p>
&lt;p>那也可以將你的 apps 使用 &lt;code>os.path.join&lt;/code>，路徑的話應該會是 &lt;code>apps/**/*.py&lt;/code>。&lt;/p>
&lt;p>注意：&lt;code>app1/migrations/&lt;/code>，在執行的時候無法使用 Cython ， 會出錯誤。&lt;/p>
&lt;p>注意：&lt;code>app1/migrations/&lt;/code>，在執行的時候無法使用 Cython ， 會出錯誤。&lt;/p>
&lt;p>注意：&lt;code>app1/migrations/&lt;/code>，在執行的時候無法使用 Cython ， 會出錯誤。&lt;/p>
&lt;blockquote>
&lt;p>若你解決了，可以再留言跟我分享，你的方式。&lt;/p>
&lt;/blockquote>
&lt;h3 id="主要程式碼">主要程式碼&lt;/h3>
&lt;p>這邊如果你是參考 Reference 第一篇文章的話，他是沒有第 3 行迴圈的部分，&lt;/p>
&lt;p>這邊我主要是忽略 &lt;code>app1/migrations/&lt;/code> 資料夾產生的錯誤。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python3" data-lang="python3">&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">to_so&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">format_folder&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">app_file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">function_file&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">format_folder&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ext_modules&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">Extension&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;*&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="p">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">setup&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;py to so&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cmdclass&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;build_ext&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">build_ext&lt;/span>&lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ext_modules&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">cythonize&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ext_modules&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">language_level&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;3&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="n">Cython&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Compiler&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Errors&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CompileError&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 獲取檔名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">filename&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">filename&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">popen&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;autopep8 --in-place --aggressive --aggressive &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">getcwd&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">filename&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 繼續轉換&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">to_so&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="vm">__name__&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">to_so&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>接下來，我們要執行這支程式。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">root@DESKTOP-xxx:/core# &lt;span class="nb">source&lt;/span> /venv/bin/activate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>venv&lt;span class="o">)&lt;/span> root@DESKTOP-xxx:/core# python build_py_to_so.py build
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>這時發現 &lt;code>app1&lt;/code> 資料夾內副檔名為 &lt;code>.c&lt;/code> 的檔案。另外也會產出一個 &lt;code>build&lt;/code> 資料夾。&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>venv&lt;span class="o">)&lt;/span> root@DESKTOP-xxx:/core# tree -L &lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── apps
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── app1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── functions
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── migrations
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── .... 檔案太多, 吃掉 ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── views.c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── views.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── build &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── lib.linux-x86_64-3.7 &lt;span class="c1"># 主要 django app 程式碼都在此處&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── connect.cpython-37m-x86_64-linux-gnu.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ ├── app1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ ├── __init__.cpython-37m-x86_64-linux-gnu.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ ├── admin.cpython-37m-x86_64-linux-gnu.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ ├── apps.cpython-37m-x86_64-linux-gnu.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ ├── models.cpython-37m-x86_64-linux-gnu.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ ├── tests.cpython-37m-x86_64-linux-gnu.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ ├── urls.cpython-37m-x86_64-linux-gnu.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ │ └── views.cpython-37m-x86_64-linux-gnu.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ │ └── format.cpython-37m-x86_64-linux-gnu.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── temp.linux-x86_64-3.7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── mnt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── build_clear.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── build_py_to_so.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── venv
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>這樣我們就把 python 轉成 cython 檔案囉！&lt;/p>
&lt;p>但我們如果要將程式碼交給客戶時，只要將 so 檔案，放入原本的資料夾內，&lt;/p>
&lt;p>python 也會優先執行 cython 的檔案唷 !!!&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>venv&lt;span class="o">)&lt;/span> root@DESKTOP-xxx:/core# tree -L &lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── apps
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── app1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── .... 檔案太多, 吃掉 ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── views.c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── views.cpython-37m-x86_64-linux-gnu.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── views.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── build
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── lib.linux-x86_64-3.7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── temp.linux-x86_64-3.7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── build_clear.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── build_py_to_so.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── venv
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>這時候，我們就完成將 python 轉成 cython 程式碼囉 !!!&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>venv&lt;span class="o">)&lt;/span> root@DESKTOP-xxx:/core# tree -L &lt;span class="m">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── apps
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── app1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── .... 檔案太多, 吃掉 ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ ├── urls.cpython-37m-x86_64-linux-gnu.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│ └── views.cpython-37m-x86_64-linux-gnu.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── build_clear.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── build_py_to_so.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── venv
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>改成上面只剩下 &lt;code>app1&lt;/code> 的資料夾底下只有 &lt;code>.so&lt;/code> 檔的方式，沒意外的話也要能夠執行喔 !!&lt;/p>
&lt;h3 id="執行結果">執行結果&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>venv&lt;span class="o">)&lt;/span> root@DESKTOP-xxx:/core/apps# tree -L &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── app1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── __init__.cpython-37m-x86_64-linux-gnu.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── __pycache__
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── admin.cpython-37m-x86_64-linux-gnu.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── apps.cpython-37m-x86_64-linux-gnu.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── functions
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── migrations
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── models.cpython-37m-x86_64-linux-gnu.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── tests.cpython-37m-x86_64-linux-gnu.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── urls.cpython-37m-x86_64-linux-gnu.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── views.cpython-37m-x86_64-linux-gnu.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">4&lt;/span> directories, &lt;span class="m">7&lt;/span> files
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>venv&lt;span class="o">)&lt;/span> root@DESKTOP-xxx:/core/apps# python ../manage.py runserver 0.0.0.0:8555
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2022-07-12 08:28:46 - autoreload.py -&amp;gt; run_with_reloader&lt;span class="o">()&lt;/span> : Watching &lt;span class="k">for&lt;/span> file changes with StatReloader
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Performing system checks...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">System check identified no issues &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> silenced&lt;span class="o">)&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">July 12, &lt;span class="m">2022&lt;/span> - 08:28:46
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Django version 3.2.13, using settings &lt;span class="s1">&amp;#39;core.settings&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Starting development server at http://0.0.0.0:8555/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Quit the server with CONTROL-C.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://chunyenc.github.io/p/2022-django-01-protect-code/result.png"
width="312"
height="136"
srcset="https://chunyenc.github.io/p/2022-django-01-protect-code/result_huef6d3e8cb357a6fc35f094b44f7b0188_4500_480x0_resize_box_3.png 480w, https://chunyenc.github.io/p/2022-django-01-protect-code/result_huef6d3e8cb357a6fc35f094b44f7b0188_4500_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="執行結果, 我的 index XD"
class="gallery-image"
data-flex-grow="229"
data-flex-basis="550px"
>&lt;/p>
&lt;h1 id="reference">Reference&lt;/h1>
&lt;ol>
&lt;li>&lt;a class="link" href="https://imshanks.com/2019/08/03/converting-django-project-py-file-to-so-file.html" target="_blank" rel="noopener"
>https://imshanks.com/2019/08/03/converting-django-project-py-file-to-so-file.html&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://cython.readthedocs.io/en/latest/" target="_blank" rel="noopener"
>https://cython.readthedocs.io/en/latest/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://gist.github.com/CHunYenc/adcdd234aab33d621fdfa127e41ee16a" target="_blank" rel="noopener"
>https://gist.github.com/CHunYenc/adcdd234aab33d621fdfa127e41ee16a&lt;/a>&lt;/li>
&lt;/ol></description></item></channel></rss>