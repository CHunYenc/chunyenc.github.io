<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>PHP on CY | 程式小角落</title><link>/tags/php/</link><description>Recent content in PHP on CY | 程式小角落</description><generator>Hugo -- gohugo.io</generator><language>zh-tw</language><managingEditor>admin@chunyen.xyz (陳雋諺, Chun-Yen Chen)</managingEditor><webMaster>admin@chunyen.xyz (陳雋諺, Chun-Yen Chen)</webMaster><lastBuildDate>Fri, 03 Nov 2023 18:50:00 +0000</lastBuildDate><atom:link href="/tags/php/index.xml" rel="self" type="application/rss+xml"/><item><title>Laravel(v5) - 更改 Response Download PDF 到直接打開 PDF</title><link>/p/laravelv05-change-response-download/</link><pubDate>Fri, 03 Nov 2023 18:50:00 +0000</pubDate><author>admin@chunyen.xyz (陳雋諺, Chun-Yen Chen)</author><guid>/p/laravelv05-change-response-download/</guid><description>碰到 Laravel v5.x 還沒有 response()->file() 所以紀錄一下解決方式</description><tags><tag>PHP</tag><tag>Laravel</tag></tags><categories><category>Experience</category></categories><image/><content>&lt;h1 id="前言">前言&lt;/h1>
&lt;p>公司官網使用 &lt;code>Laravel v5.1.x&lt;/code>, 有一個功能是要讓使用者可以下載 PDF 檔案，但是原本的寫法是使用 &lt;code>response()-&amp;gt;download()&lt;/code>，但是這樣會導致使用者下載後還要再去開啟 PDF 檔案，所以要改成直接開啟 PDF 檔案。&lt;/p>
&lt;p>但是我一開始發現 &lt;code>laravel v10.x&lt;/code>, 有 &lt;code>response()-&amp;gt;file()&lt;/code> 可以使用，但是 &lt;code>laravel v5.x&lt;/code> 沒有，所以要另外找方法。&lt;/p>
&lt;h2 id="流程">流程&lt;/h2>
&lt;p>簡單來說操作流程如下, 因為主要在改善使用者瀏覽 PDF 或下載檔案的流程。&lt;/p>
&lt;h3 id="改善前">改善前&lt;/h3>
&lt;div class="mermaid">flowchart LR
step1["點擊下載按鈕"]
step2["等待下載 PDF 檔案
(瀏覽器跳出下載視窗)"]
step3["開啟 PDF 檔案
(使用者自行開啟)"]
step1 --> step2 --> step3
&lt;/div>
&lt;p>可以發現說, 使用者需要等待下載 PDF 檔案, 然後再去開啟(手動) PDF 檔案。&lt;/p>
&lt;h3 id="改善後">改善後&lt;/h3>
&lt;div class="mermaid">flowchart LR
step1["點擊下載按鈕"]
step2["等待開啟 PDF 檔案
(瀏覽器直接開啟 PDF 檔案)"]
step1 --> step2
&lt;/div>
&lt;p>這樣中間就會少一個步驟, 讓使用者可以直接開啟 PDF 檔案。&lt;/p>
&lt;h2 id="更改程式碼前">更改程式碼前&lt;/h2>
&lt;p>因為公司是使用 &lt;code>Laravel v5.1.x&lt;/code>, 所以我們要去找到原本的程式碼在哪裡。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># download.blade.php
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">td&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">@&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">empty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$value2&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;file&amp;#39;&lt;/span>&lt;span class="p">]))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">a&lt;/span> &lt;span class="nx">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;{{ xx::url(&amp;#39;download/&amp;#39;.&lt;/span>&lt;span class="si">$value2[&amp;#39;id&amp;#39;]&lt;/span>&lt;span class="s2">.&amp;#39;?time=&amp;#39;.time())}}&amp;#34;&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;&lt;/span>&lt;span class="nx">img&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;../../assets/images/icons/icon-pdf.png&amp;#34;&lt;/span> &lt;span class="nx">alt&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;icon-pdf&amp;#34;&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">@&lt;/span>&lt;span class="k">endif&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="nx">td&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>從上面的 HTML 可以知道, 下載的路徑是 &lt;code>download/{id}&lt;/code>。&lt;/p>
&lt;p>然後還有搭配一個 Icon, 這邊就不多做介紹。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="o">....&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># download/{id}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">return&lt;/span> &lt;span class="nx">response&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">download&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$file_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$file_name&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">....&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>這邊就是原本的下載 PDF 檔案的程式碼, 這邊就是會直接透過瀏覽器下載 PDF 檔案。&lt;/p>
&lt;h2 id="有趣的事情">有趣的事情&lt;/h2>
&lt;p>因為透過 PDF 直接打開後，會發現到每次開啟檔案都不是 PDF 檔名了。而是 PDF 文件標題，而公司文件的標題非常的亂 &amp;hellip; 甚至還有一些奇怪的符號、COPY 其他公司的文件來改的 .. 所以後面我又寫了一隻 Python 程式來幫我把全部 PDF 檔案的標題改掉。&lt;/p>
&lt;p>至於 PHP 能不能夠改 PDF 的檔案標題，我沒有找到方法，所以就用 Python 來做了。&lt;/p>
&lt;p>如果你是用 PHP 的話，也歡迎你跟我說你用什麼套件來改 PDF 檔案標題。&lt;/p></content></item><item><title>Php - XAMPP x64 安裝 Oracle Instant Client</title><link>/p/xampp-x64-oracle-instant-client/</link><pubDate>Mon, 21 Aug 2023 07:41:54 +0000</pubDate><author>admin@chunyen.xyz (陳雋諺, Chun-Yen Chen)</author><guid>/p/xampp-x64-oracle-instant-client/</guid><description>公司使用 x64 的OCI8一直沒成功，這邊算是紀錄解決的關鍵點</description><tags><tag>Oracle</tag><tag>PHP</tag><tag>Database</tag></tags><categories><category>Experience</category></categories><image/><content>&lt;h1 id="前言">前言&lt;/h1>
&lt;p>近期換了工作，而這份工作是使用原生 PHP。有預計會升級為 &lt;code>Laravel&lt;/code>。&lt;/p>
&lt;p>那在安裝 PHP 開發過程中，遇到一個令人挑戰的問題。公司前輩沒有使用 XAMPP x64 環境下成功安裝 OCI8。主要還是我&lt;code>自發性&lt;/code>去解決這個問題。主要我覺得很簡單，但是中間還是碰到一些問題，所以才會留下這篇文章。&lt;/p>
&lt;p>所以到我解決這件事情前，公司到目前上線的系統都是使用 x32 架構的 OCI8。接下來還要把上線的系統改為 &lt;code>x64&lt;/code>，所以接下來有得忙了 XD&lt;/p>
&lt;p>希望這篇文章能為那些正在尋找解決方案的人們提供一些有價值的指引，幫助大家節省時間和精力。&lt;/p>
&lt;h1 id="關鍵">關鍵&lt;/h1>
&lt;p>主要系統為 &lt;code>Windows&lt;/code>，若要使用 &lt;code>Linux&lt;/code> 可以參考一下安裝過程。&lt;/p>
&lt;h2 id="安裝-xampp">安裝 XAMPP&lt;/h2>
&lt;p>建議優先安裝 &lt;code>Windows x64 v8.1.17 版本&lt;/code>&lt;/p>
&lt;p>&lt;a class="link" href="https://sourceforge.net/projects/xampp/files/XAMPP%20Windows/8.1.17/xampp-windows-x64-8.1.17-0-VS16-installer.exe/download" target="_blank" rel="noopener"
>https://sourceforge.net/projects/xampp/files/XAMPP%20Windows/8.1.17/xampp-windows-x64-8.1.17-0-VS16-installer.exe/download&lt;/a>&lt;/p>
&lt;p>筆者這邊省略安裝過程。&lt;/p>
&lt;h2 id="安裝-oracle-instant-client-驅動程式">安裝 Oracle Instant Client 驅動程式&lt;/h2>
&lt;p>筆者公司是使用 &lt;code>Oracle 11g&lt;/code>。&lt;/p>
&lt;p>前輩使用的 Oracle Client 的版本為 &lt;code>12.2.0.1.0&lt;/code>，那我就版本一樣沒有改。&lt;/p>
&lt;p>驅動網址：&lt;a class="link" href="https://www.oracle.com/tw/database/technologies/instant-client/winx64-64-downloads.html" target="_blank" rel="noopener"
>https://www.oracle.com/tw/database/technologies/instant-client/winx64-64-downloads.html&lt;/a>&lt;/p>
&lt;h3 id="解壓縮並移動全部-dll-檔案">解壓縮並移動全部 dll 檔案&lt;/h3>
&lt;p>首先我們下載完 Oracle Client，就直接解壓縮。&lt;/p>
&lt;p>然後排序&lt;code>檔案類型&lt;/code>，我們要的是 &lt;code>應用程式擴充&lt;/code>，為 .dll 副檔名的檔案。&lt;/p>
&lt;p>如下圖，我們全部複製。&lt;/p>
&lt;p>&lt;img src="/images/20230821_xampp-oci/01.dll-files.png"
loading="lazy"
alt="全部的 dll 檔案"
>&lt;/p>
&lt;h3 id="複製到-xamppapachebin-資料夾">複製到 xampp\apache\bin 資料夾&lt;/h3>
&lt;p>&lt;img src="/images/20230821_xampp-oci/02.apache.png"
loading="lazy"
alt="將 dll 移至 apache/bin 資料夾"
>&lt;/p>
&lt;blockquote>
&lt;p>關鍵之一，如果今天我們使用 XAMPP 啟用 PHP 時，這邊沒有 dll 檔案時，我們的 OCI8 就沒辦法啟動。&lt;/p>
&lt;/blockquote>
&lt;h3 id="複製到-xamppphp-資料夾">複製到 xampp\php 資料夾&lt;/h3>
&lt;p>&lt;img src="/images/20230821_xampp-oci/03.php.png"
loading="lazy"
alt="將 dll 移至 xampp/php 資料夾"
>&lt;/p>
&lt;blockquote>
&lt;p>關鍵之二，如果今天我們 PHP 時，這邊沒有 dll 檔案時，使用 &lt;code>php -m&lt;/code> 指令會顯示錯誤。&lt;/p>
&lt;/blockquote>
&lt;h2 id="安裝-php-oci8-插件">安裝 Php OCI8 插件&lt;/h2>
&lt;p>oci8 插件的說明：&lt;a class="link" href="https://pecl.php.net/package/oci8" target="_blank" rel="noopener"
>https://pecl.php.net/package/oci8&lt;/a>&lt;/p>
&lt;p>筆者目前在 &lt;code>Windows&lt;/code> 最新版為 &lt;code>3.2.1&lt;/code>。&lt;/p>
&lt;p>而網頁中的描述也有提到 &lt;code>Use 'pecl install oci8-3.2.1' to install for PHP 8.1.&lt;/code>，所以我們的 XAMPP 的 PHP 指定版本為 &lt;code>8.1.17&lt;/code>。&lt;/p>
&lt;blockquote>
&lt;p>關鍵之三，所以插件的版本與 PHP 的版本是互相關聯的。 &lt;code>記得要安裝 ts 版本。&lt;/code>，你可以參考下圖。&lt;/p>
&lt;/blockquote>
&lt;p>&lt;img src="/images/20230821_xampp-oci/04.php_info.png"
loading="lazy"
alt="確認 PHP 有無支援 Thread Safety"
>&lt;/p>
&lt;blockquote>
&lt;p>上面這張圖的紅框位置，會影響到插件的版本&lt;/p>
&lt;/blockquote>
&lt;h3 id="移動-oci8-插件的-dll-檔案">移動 OCI8 插件的 dll 檔案&lt;/h3>
&lt;p>首先我們先進行解壓縮。&lt;/p>
&lt;p>再依照 &lt;code>應用程式擴充&lt;/code> 排序，所以你現在的畫面會與下圖一樣。&lt;/p>
&lt;p>&lt;img src="/images/20230821_xampp-oci/05.php-oci-driver.jpg"
loading="lazy"
alt="OCI8 插件圖片"
>&lt;/p>
&lt;p>然後把紅框選取的檔案複製到下圖 &lt;code>XAMPP PHP&lt;/code> 插件位置。&lt;/p>
&lt;p>&lt;img src="/images/20230821_xampp-oci/06.jpg"
loading="lazy"
alt="OCI8 插件的 PHP 位置"
>&lt;/p>
&lt;h2 id="設定-phpini">設定 php.ini&lt;/h2>
&lt;p>驅動程式到這邊都裝好了。&lt;/p>
&lt;p>接下來要讓 PHP 啟用，需要到下圖的位置 &lt;code>xampp/php/php.ini&lt;/code> 檔案來啟用 &lt;code>OCI&lt;/code> .&lt;/p>
&lt;p>&lt;img src="/images/20230821_xampp-oci/07.jpg"
loading="lazy"
alt="PHP ini 啟動 OCI 位置"
>&lt;/p>
&lt;blockquote>
&lt;p>這邊筆者是啟用 &lt;code>oci8_19&lt;/code>，來進行測試。&lt;/p>
&lt;/blockquote>
&lt;h2 id="檢查有無啟用">檢查有無啟用&lt;/h2>
&lt;p>&lt;img src="/images/20230821_xampp-oci/08.jpg"
loading="lazy"
alt="檢查 OCI8 有無安裝成功"
>&lt;/p>
&lt;h2 id="完成">完成&lt;/h2></content></item></channel></rss>