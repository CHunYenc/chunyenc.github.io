<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Laravel on CY | 程式小角落</title><link>https://chunyenc.github.io/tags/laravel/</link><description>Recent content in Laravel on CY | 程式小角落</description><generator>Hugo -- gohugo.io</generator><language>zh-tw</language><managingEditor>admin@chunyen.xyz (陳雋諺, Chun-Yen Chen)</managingEditor><webMaster>admin@chunyen.xyz (陳雋諺, Chun-Yen Chen)</webMaster><lastBuildDate>Fri, 03 Nov 2023 18:50:00 +0000</lastBuildDate><atom:link href="https://chunyenc.github.io/tags/laravel/index.xml" rel="self" type="application/rss+xml"/><item><title>Laravel(v5) - 更改 Response Download PDF 到直接打開 PDF</title><link>https://chunyenc.github.io/p/laravelv05-change-response-download/</link><pubDate>Fri, 03 Nov 2023 18:50:00 +0000</pubDate><author>admin@chunyen.xyz (陳雋諺, Chun-Yen Chen)</author><guid>https://chunyenc.github.io/p/laravelv05-change-response-download/</guid><description>碰到 Laravel v5.x 還沒有 response()->file() 所以紀錄一下解決方式</description><tags><tag>PHP</tag><tag>Laravel</tag></tags><categories><category>Experience</category></categories><image/><content>&lt;h1 id="前言">前言&lt;/h1>
&lt;p>公司官網使用 &lt;code>Laravel v5.1.x&lt;/code>, 有一個功能是要讓使用者可以下載 PDF 檔案，但是原本的寫法是使用 &lt;code>response()-&amp;gt;download()&lt;/code>，但是這樣會導致使用者下載後還要再去開啟 PDF 檔案，所以要改成直接開啟 PDF 檔案。&lt;/p>
&lt;p>但是我一開始發現 &lt;code>laravel v10.x&lt;/code>, 有 &lt;code>response()-&amp;gt;file()&lt;/code> 可以使用，但是 &lt;code>laravel v5.x&lt;/code> 沒有，所以要另外找方法。&lt;/p>
&lt;h2 id="流程">流程&lt;/h2>
&lt;p>簡單來說操作流程如下, 因為主要在改善使用者瀏覽 PDF 或下載檔案的流程。&lt;/p>
&lt;h3 id="改善前">改善前&lt;/h3>
&lt;div class="mermaid">flowchart LR
step1["點擊下載按鈕"]
step2["等待下載 PDF 檔案
(瀏覽器跳出下載視窗)"]
step3["開啟 PDF 檔案
(使用者自行開啟)"]
step1 --> step2 --> step3
&lt;/div>
&lt;p>可以發現說, 使用者需要等待下載 PDF 檔案, 然後再去開啟(手動) PDF 檔案。&lt;/p>
&lt;h3 id="改善後">改善後&lt;/h3>
&lt;div class="mermaid">flowchart LR
step1["點擊下載按鈕"]
step2["等待開啟 PDF 檔案
(瀏覽器直接開啟 PDF 檔案)"]
step1 --> step2
&lt;/div>
&lt;p>這樣中間就會少一個步驟, 讓使用者可以直接開啟 PDF 檔案。&lt;/p>
&lt;h2 id="更改程式碼前">更改程式碼前&lt;/h2>
&lt;p>因為公司是使用 &lt;code>Laravel v5.1.x&lt;/code>, 所以我們要去找到原本的程式碼在哪裡。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># download.blade.php
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">td&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">@&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="k">empty&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$value2&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;file&amp;#39;&lt;/span>&lt;span class="p">]))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="nx">a&lt;/span> &lt;span class="nx">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;{{ xx::url(&amp;#39;download/&amp;#39;.&lt;/span>&lt;span class="si">$value2[&amp;#39;id&amp;#39;]&lt;/span>&lt;span class="s2">.&amp;#39;?time=&amp;#39;.time())}}&amp;#34;&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;&lt;/span>&lt;span class="nx">img&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;../../assets/images/icons/icon-pdf.png&amp;#34;&lt;/span> &lt;span class="nx">alt&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;icon-pdf&amp;#34;&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nx">a&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">@&lt;/span>&lt;span class="k">endif&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="nx">td&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>從上面的 HTML 可以知道, 下載的路徑是 &lt;code>download/{id}&lt;/code>。&lt;/p>
&lt;p>然後還有搭配一個 Icon, 這邊就不多做介紹。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-php" data-lang="php">&lt;span class="line">&lt;span class="cl">&lt;span class="o">....&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># download/{id}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">return&lt;/span> &lt;span class="nx">response&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="na">download&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nv">$file_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nv">$file_name&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">....&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>這邊就是原本的下載 PDF 檔案的程式碼, 這邊就是會直接透過瀏覽器下載 PDF 檔案。&lt;/p>
&lt;h2 id="有趣的事情">有趣的事情&lt;/h2>
&lt;p>因為透過 PDF 直接打開後，會發現到每次開啟檔案都不是 PDF 檔名了。而是 PDF 文件標題，而公司文件的標題非常的亂 &amp;hellip; 甚至還有一些奇怪的符號、COPY 其他公司的文件來改的 .. 所以後面我又寫了一隻 Python 程式來幫我把全部 PDF 檔案的標題改掉。&lt;/p>
&lt;p>至於 PHP 能不能夠改 PDF 的檔案標題，我沒有找到方法，所以就用 Python 來做了。&lt;/p>
&lt;p>如果你是用 PHP 的話，也歡迎你跟我說你用什麼套件來改 PDF 檔案標題。&lt;/p></content></item></channel></rss>